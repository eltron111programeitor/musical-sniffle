name: Build Android APK Autom√°tico
permissions:
  contents: read 
on:
  push:
    branches: [main]
  workflow_dispatch:  # Permite ejecutar manualmente

jobs:
  build-apk:
    runs-on: ubuntu-latest
    
    steps:
    - name: 1. Descargar proyecto
      uses: actions/checkout@v4
      
    - name: 2. Descargar Godot 4.4.1
      run: |
        wget -q https://github.com/godotengine/godot/releases/download/4.4.1-stable/Godot_v4.4.1-stable_linux.x86_64.zip
        unzip -q Godot_v4.4.1-stable_linux.x86_64.zip
        chmod +x Godot_v4.4.1-stable_linux.x86_64
        echo "‚úÖ Godot descargado"
        
    - name: 3. Verificar estructura y configuraci√≥n
      run: |
        echo "üìÅ Estructura del proyecto:"
        ls -la
        echo "üìÅ Dentro de fnf-2-try:"
        ls -la fnf-2-try/
        echo "üìÑ Verificando export_presets.cfg..."
        if grep -q "name=\"Android\"" fnf-2-try/export_presets.cfg; then
          echo "‚úÖ Preset 'Android' encontrado"
          grep "name=" fnf-2-try/export_presets.cfg
        else
          echo "‚ùå ERROR: No hay preset 'Android'"
          echo "Contenido del archivo:"
          cat fnf-2-try/export_presets.cfg
          exit 1
        fi
        
    - name: 4. Crear APK Android
      run: |
        cd fnf-2-try
        echo "üéÆ Exportando APK desde fnf-2-try..."
        ../Godot_v4.4.1-stable_linux.x86_64 --headless --export-debug "Android" ../musical_sniffle.apk
        echo "‚úÖ APK creado"
        
    - name: 5. Verificar APK creado
      run: |
        echo "üì¶ Archivos creados:"
        ls -lh *.apk || echo "‚ö†Ô∏è No hay APK"
        
    - name: 6. Subir APK para descargar
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: Musical-Sniffle-APK
        path: musical_sniffle.apk
        retention-days: 7
